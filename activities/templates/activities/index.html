{% extends "activities/layout.html" %}

{% block content %}
<div class="container mt-4">
     {% if messages %}
            {% for message in messages %}
                <div class="alert
                            {% if message.tags == 'success' %}alert-success
                            {% else %}alert-danger{% endif %}
                            alert-dismissible fade show mt-3" role="alert" aria-live="polite" aria-atomic="true">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    <h2 class="mb-3 text-center">Activités à venir</h2>

    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <a href="?view=toutes_activites"
                    class="btn btn-sm {% if view_filter == 'toutes_activites' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                    Toutes les activités
                </a>
                {% if user.is_authenticated %}
                <a href="?view=mes_activites"
                    class="btn btn-sm {% if view_filter == 'mes_activites' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                    Mes activités proposées
                </a>
                <a href="?view=mes_inscriptions"
                    class="btn btn-sm {% if view_filter == 'mes_inscriptions' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                    Mes inscriptions
                </a>
                {% endif %}
            </div>
        </div>
        <div class="col-md-4">
            <form method="get" class="mb-4">
                <input type="hidden" name="view" value="{{ view_filter }}">
                <select name="category" class="form-select w-auto d-inline" onchange="this.form.submit()">
                    <option value="">Toutes les catégories</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}">
                        {{ cat.name }}
                    </option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>

    <div class="row">
    {% for activity in page %}
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ activity.title }}</h5>
                    <p class="card-text">
                        <strong>Ville :</strong> {{ activity.location_city }} <br>
                        <strong>Catégorie :</strong> {{ activity.category.name }} <br>
                        <strong>Date :</strong> {{ activity.start_time|date:"d/m/Y H:i" }} <br>
                        <strong>Organisateur :</strong>
                        {% if user.is_authenticated and user == activity.proposer %}
                            Moi
                        {% else %}
                            {{ activity.proposer.username }}
                        {% endif %}
                    </p>
                    <a href="{% url 'activity_detail' activity.id %}" class="btn btn-primary btn-sm">Voir détails</a>
                </div>
            </div>
        </div>
    {% empty %}
        <p class="text-center">Aucune activité trouvée.</p>
    {% endfor %}
    </div>

    <nav>
        <ul class="pagination">
            {% if page.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?view={{ view_filter }}&category={{ category_filter }}&page={{ page.previous_page_number }}">Précédent</a>
                </li>
            {% endif %}
            <li class="page-item disabled"><span class="page-link">Page {{ page.number }} / {{ page.paginator.num_pages }}</span></li>
            {% if page.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?view={{ view_filter }}&category={{ category_filter }}&page={{ page.next_page_number }}">Suivant</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endblock %}
